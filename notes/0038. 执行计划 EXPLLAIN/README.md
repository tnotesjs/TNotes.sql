# [0038. æ‰§è¡Œè®¡åˆ’ EXPLLAIN](https://github.com/Tdahuyou/TNotes.sql/tree/main/notes/0038.%20%E6%89%A7%E8%A1%8C%E8%AE%A1%E5%88%92%20EXPLLAIN)

<!-- region:toc -->

- [1. ğŸ“ æ¦‚è¿°](#1--æ¦‚è¿°)
- [2. ğŸ¤” å¦‚ä½•åˆ¤æ–­ç´¢å¼•æ˜¯å¦ç”Ÿæ•ˆï¼Ÿ](#2--å¦‚ä½•åˆ¤æ–­ç´¢å¼•æ˜¯å¦ç”Ÿæ•ˆ)

<!-- endregion:toc -->

## 1. ğŸ“ æ¦‚è¿°

- `EXPLAIN` æ˜¯åˆ†æ SQL æ‰§è¡Œè·¯å¾„çš„é‡è¦å·¥å…·ï¼Œé€šè¿‡æŸ¥çœ‹ `type`ã€`key` å’Œ `Extra` å­—æ®µï¼Œå¯ä»¥åˆ¤æ–­æŸ¥è¯¢æ˜¯å¦ä½¿ç”¨äº†ç´¢å¼•ã€æ˜¯å¦å­˜åœ¨æ€§èƒ½ç“¶é¢ˆï¼Œå¹¶æŒ‡å¯¼åç»­çš„ç´¢å¼•ä¼˜åŒ–ç­–ç•¥ã€‚
- `EXPLAIN`
  - `EXPLAIN` æ˜¯ MySQL ä¸­ç”¨äºæŸ¥çœ‹ SQL æŸ¥è¯¢æ‰§è¡Œè®¡åˆ’çš„å…³é”®å­—ã€‚
  - å®ƒå¯ä»¥å¸®åŠ©ä½ äº†è§£ï¼š
    - MySQL æ˜¯å¦‚ä½•è®¿é—®è¡¨å’Œç´¢å¼•çš„
    - æ˜¯å¦ä½¿ç”¨äº†ç´¢å¼•
    - æŸ¥è¯¢æ˜¯å…¨è¡¨æ‰«æè¿˜æ˜¯èŒƒå›´æ‰«æ
    - æ˜¯å¦éœ€è¦ä¸´æ—¶è¡¨æˆ–æ’åºç­‰
  - å¯¹ä¼˜åŒ–æŸ¥è¯¢æ€§èƒ½ã€è°ƒæ•´ç´¢å¼•è®¾è®¡éå¸¸å…³é”®ã€‚
- **`EXPLAIN` åŸºæœ¬è¯­æ³•ç¤ºä¾‹**
  - `EXPLAIN SELECT * FROM employees WHERE salary > 5000;`
  - åªæ˜¾ç¤ºæ‰§è¡Œè®¡åˆ’ï¼Œ**ä¸çœŸæ­£æ‰§è¡ŒæŸ¥è¯¢**ã€‚
- **è¾“å‡ºå­—æ®µè¯¦è§£**

| å­—æ®µå          | æè¿°                                                  |
| --------------- | ----------------------------------------------------- |
| `id`            | æŸ¥è¯¢ä¸­æ¯ä¸ª SELECT çš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼ˆå¤æ‚æŸ¥è¯¢ä¸­æœ‰å¤šä¸ª idï¼‰ |
| `select_type`   | æŸ¥è¯¢ç±»å‹                                              |
| `table`         | æ­£åœ¨è®¿é—®çš„è¡¨å                                        |
| `partitions`    | åŒ¹é…çš„åˆ†åŒºï¼ˆå¦‚æœä½¿ç”¨äº†åˆ†åŒºè¡¨ï¼‰                        |
| `type`          | è¡¨è¿æ¥ç±»å‹                                            |
| `possible_keys` | å¯èƒ½ç”¨åˆ°çš„ç´¢å¼•                                        |
| `key`           | å®é™…ä½¿ç”¨çš„ç´¢å¼•                                        |
| `key_len`       | ä½¿ç”¨çš„ç´¢å¼•é•¿åº¦                                        |
| `ref`           | æ˜¾ç¤ºå“ªäº›åˆ—æˆ–å¸¸é‡è¢«ç”¨æ¥å’Œç´¢å¼•æ¯”è¾ƒ                      |
| `rows`          | MySQL è®¤ä¸ºæ‰§è¡ŒæŸ¥è¯¢éœ€è¦æ‰«æçš„è¡Œæ•°ï¼ˆä¼°ç®—ï¼‰              |
| `Extra`         | åŒ…å«é¢å¤–ä¿¡æ¯                                          |

- `select_type`
  - `SIMPLE`ï¼šç®€å•æŸ¥è¯¢ï¼Œæ²¡æœ‰å­æŸ¥è¯¢æˆ–å­æŸ¥è¯¢çš„ FROM åˆ—è¡¨ã€‚
  - `PRIMARY`ï¼šä¸»æŸ¥è¯¢ï¼Œå³æœ€å¤–å±‚çš„ SELECTã€‚
  - `SUBQUERY`ï¼šå­æŸ¥è¯¢
  - `DERIVED`ï¼šè¡ç”Ÿè¡¨ - å­æŸ¥è¯¢çš„ FROM åˆ—è¡¨
- `type`
  - type å­—æ®µåæ˜ äº† MySQL è®¿é—®è¡¨çš„æ–¹å¼ã€‚ç†æƒ³æƒ…å†µä¸‹ï¼Œè‡³å°‘è¦è¾¾åˆ° range æˆ– refï¼›å¦‚æœå‡ºç° ALLï¼Œåº”ä¼˜å…ˆè€ƒè™‘æ·»åŠ åˆé€‚çš„ç´¢å¼•ä»¥æå‡æŸ¥è¯¢æ€§èƒ½ã€‚

| ç±»å‹ | æè¿° | æ€§èƒ½ |
| --- | --- | --- |
| `system` | è¡¨ä¸­åªæœ‰ä¸€è¡Œè®°å½•ï¼ˆç³»ç»Ÿè¡¨ï¼‰ | â­â­â­â­â­ |
| `const` | é€šè¿‡ä¸»é”®æˆ–å”¯ä¸€ç´¢å¼•å®šä½ä¸€è¡Œ | â­â­â­â­ |
| `eq_ref` | å”¯ä¸€ç´¢å¼•ç­‰å€¼åŒ¹é…ï¼Œé€šå¸¸å‡ºç°åœ¨ JOIN ä¸­ | â­â­â­â­ |
| `ref` | éå”¯ä¸€ç´¢å¼•ç­‰å€¼åŒ¹é… | â­â­â­ |
| `range` | ä½¿ç”¨ç´¢å¼•è¿›è¡ŒèŒƒå›´æŸ¥æ‰¾ï¼ˆå¦‚ `>`, `<`, `BETWEEN`ï¼‰ | â­â­ |
| `index` | æ‰«ææ•´ä¸ªç´¢å¼•æ ‘ï¼Œä½†æœªè¿›è¡Œæ¡ä»¶è¿‡æ»¤ | â­ |
| `ALL` | å…¨è¡¨æ‰«æï¼ˆæœ€æ…¢ï¼Œé€šå¸¸åº”é¿å…ï¼Œé™¤éè¡¨éå¸¸å°æˆ–å‘½ä¸­å¤§é‡æ•°æ®ï¼‰ | âŒ |

- `Extra`
  - `Using where`ï¼šä½¿ç”¨äº† WHERE æ¡ä»¶è¿‡æ»¤
  - `Using index`ï¼šä½¿ç”¨è¦†ç›–ç´¢å¼•ï¼ˆç´¢å¼•åŒ…å«æŸ¥è¯¢çš„æ‰€æœ‰åˆ—ï¼‰
  - `Using filesort`ï¼šä½¿ç”¨äº†ä¸´æ—¶è¡¨æˆ–æ’åºï¼Œéœ€è¦è¿›è¡Œé¢å¤–æ’åºï¼ˆæ€§èƒ½å·®ï¼‰
  - `Using temporary`ï¼šä½¿ç”¨äº†ä¸´æ—¶è¡¨ï¼Œéœ€è¦è¿›è¡Œæ’åºï¼ˆæ€§èƒ½å·®ï¼‰

## 2. ğŸ¤” å¦‚ä½•åˆ¤æ–­ç´¢å¼•æ˜¯å¦ç”Ÿæ•ˆï¼Ÿ

- åˆ¤æ–­æ–¹æ³•ï¼š
  - æŸ¥çœ‹ `key` å­—æ®µæ˜¯å¦ä½¿ç”¨äº†ç´¢å¼•
  - æŸ¥çœ‹ `Extra` æ˜¯å¦æœ‰ä»¥ä¸‹æç¤ºï¼š
    - `Using index` â†’ ä½¿ç”¨äº†è¦†ç›–ç´¢å¼•ï¼ˆæœ€å¥½ï¼‰
    - `Using where; Using index condition pushdown` â†’ ä½¿ç”¨äº†ç´¢å¼•ä¸‹æ¨ï¼ˆè¾ƒå¥½ï¼‰
  - æŸ¥çœ‹ `type` æ˜¯å¦ä¸º `range`ã€`ref`ã€`eq_ref` ç­‰é«˜æ•ˆç±»å‹
- ç´¢å¼•å¤±æ•ˆå¸¸è§æƒ…å†µï¼š
  - ä½¿ç”¨å‡½æ•°æˆ–è¡¨è¾¾å¼æ“ä½œç´¢å¼•åˆ—ï¼š`WHERE YEAR(create_time) = 2024`
  - ä½¿ç”¨ `OR` å¹¶ä¸”éƒ¨åˆ†æ¡ä»¶æ²¡æœ‰ç´¢å¼•æ”¯æŒ
  - ä½¿ç”¨ `LIKE '%abc'` è¿›è¡Œå‰ç¼€æ¨¡ç³ŠåŒ¹é…
  - æŸ¥è¯¢å­—æ®µä¸ç´¢å¼•å­—æ®µé¡ºåºä¸ä¸€è‡´ï¼ˆå¤åˆç´¢å¼•æ—¶ï¼‰
  - æŸ¥è¯¢å‘½ä¸­æ•°æ®æ¯”ä¾‹è¿‡é«˜ï¼ˆè¶…è¿‡ 20%-30%ï¼‰ï¼Œä¼˜åŒ–å™¨æ”¾å¼ƒç´¢å¼•æ”¹èµ°å…¨è¡¨æ‰«æ

::: code-group

```sql [èµ°å…¨è¡¨æ‰«æ]
EXPLAIN SELECT * FROM employees WHERE salary > 5000;

-- è¾“å‡ºç»“æœï¼š

-- +----+-------------+-----------+------------+------+---------------+------+---------+------+------+----------+-------------+
-- | id | select_type | table     | partitions | type | possible_keys | key  | key_len | ref  | rows | filtered | Extra       |
-- +----+-------------+-----------+------------+------+---------------+------+---------+------+------+----------+-------------+
-- | 1  | SIMPLE      | employees | NULL       | ALL  | idx_salary    | NULL | NULL    | NULL | 1000 |   100.00 | Using where |
-- +----+-------------+-----------+------------+------+---------------+------+---------+------+------+----------+-------------+

-- åˆ†æï¼š

-- `type: ALL` â†’ å…¨è¡¨æ‰«æ
-- `key: NULL` â†’ æœªä½¿ç”¨ç´¢å¼•
-- `Extra: Using where` â†’ æœ‰ WHERE æ¡ä»¶è¿‡æ»¤

-- è™½ç„¶ `salary` ä¸Šæœ‰ç´¢å¼•ï¼Œä½†å‘½ä¸­æ•°æ®è¿‡å¤šå¯¼è‡´ MySQL æ”¾å¼ƒä½¿ç”¨ç´¢å¼•
```

```sql [èµ°ç´¢å¼•]
EXPLAIN SELECT * FROM employees WHERE salary > 10000;

-- è¾“å‡ºç»“æœï¼š

-- +----+-------------+-----------+------------+-------+---------------+--------------+---------+------+------+----------+-----------------------+
-- | id | select_type | table     | partitions | type  | possible_keys | key          | key_len | ref  | rows | filtered | Extra                 |
-- +----+-------------+-----------+------------+-------+---------------+--------------+---------+------+------+----------+-----------------------+
-- | 1  | SIMPLE      | employees | NULL       | range | idx_salary    | idx_salary   | 5       | NULL |  100 |   100.00 | Using index condition |
-- +----+-------------+-----------+------------+-------+---------------+--------------+---------+------+------+----------+-----------------------+

-- åˆ†æï¼š

-- `type: range` â†’ ä½¿ç”¨äº†èŒƒå›´æ‰«æ
-- `key: idx_salary` â†’ ä½¿ç”¨äº†ç´¢å¼•
-- `Extra: Using index condition` â†’ ä½¿ç”¨äº†ç´¢å¼•ä¸‹æ¨

-- ç”±äºå‘½ä¸­æ•°æ®è¾ƒå°‘ï¼ŒMySQL é€‰æ‹©ä½¿ç”¨ç´¢å¼•æ¥åŠ é€ŸæŸ¥è¯¢
```
